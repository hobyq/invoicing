<template>  <div>    <v-data-table        :items-per-page="10"        :headers="headers"        :items="invoices"        class="elevation-1"        :loading="isLoading"    >      <template v-slot:top>        <v-toolbar flat>          <v-toolbar-title>Invoices List</v-toolbar-title>          <v-divider class="mx-4" inset vertical></v-divider>          <v-spacer></v-spacer>          <v-dialog v-model="dialog" max-width="500px">            <template v-slot:activator="{ on, attrs }">              <v-btn color="primary" v-bind="attrs" v-on="on">                Add Invoice              </v-btn>            </template>            <v-card>              <v-card-title>                <span class="text-h5">Details</span>              </v-card-title>              <v-card-text>                <v-select                    :items="clients"                    item-value="id"                    item-text="name"                    v-model="newInvoice.client" label="Client"></v-select>                <v-select                    :items="items"                    item-value="id"                    item-text="title"                    multiple                    attach                    chips                    v-model="newInvoice.items" label="Purchased Items"></v-select>                <v-select                    :items="states"                    item-value="id"                    item-text="label"                    v-model="newInvoice.status" label="Status"></v-select>              </v-card-text>              <v-card-actions>                <v-spacer></v-spacer>                <v-btn color="blue" text @click="close">                  Cancel                </v-btn>                <v-btn color="blue" text @click="save">                  Save                </v-btn>              </v-card-actions>            </v-card>          </v-dialog>        </v-toolbar>      </template>      <template v-slot:item.purchased_items="{ item }">        <v-data-table v-if="item.purchased_items.length > 0"                      :headers="purchaseHeaders"                      :hide-default-footer="true"                      :hide-default-header="true"                      disable-pagination                      :items="item.purchased_items"></v-data-table>      </template>      <template v-slot:item.status="{ item }">        <v-chip            :color="item.status.id === states[0].id ? 'orange' : item.status.id === states[1].id ? 'blue' : 'green'">          {{ item.status.label }}        </v-chip>        <v-btn            v-show="item.status.id === states[0].id"            color="primary"            elevation="3"            rounded            @click="sendToClient(item)"        >Sent to Client        </v-btn>        <v-btn            v-show="item.status.id === states[1].id"            color="primary"            elevation="3"            rounded            @click="markAsPaid(item)"        >Pay        </v-btn>      </template>    </v-data-table>  </div></template><script>import {api_get, api_patch, api_post} from "../plugins/network";export default {  name: "Invoices",  data: function () {    return {      headers: [        {          text: 'Invoice#',          value: 'id',          align: 'start',          sortable: true,        },        {          text: 'Client',          value: 'client.name',          align: 'start',          sortable: true,        },        {          text: 'Items Price',          value: 'items_price',          align: 'start',          sortable: true        },        {          text: 'VAT',          value: 'vat',          align: 'start',          sortable: true        },        {          text: 'Total Price',          value: 'total_price',          align: 'start',          sortable: true        },        {          text: 'Items List',          value: 'purchased_items',          align: 'start',          sortable: true,        },        {          text: 'Status',          value: 'status'        }      ],      purchaseHeaders: [        {          text: 'Item',          value: 'store_item.title',          align: 'start',          sortable: true,        },        {          text: 'Price',          value: 'purchase_price',          align: 'end',          sortable: true,        }      ],      isLoading: true,      newInvoice: {        client: {},        items: []      },      dialog: false,      invoices: [],      states: [],      clients: [],      items: [],    }  },  created() {    this.load(true)    this.init();    this.load_data();  },  methods: {    init() {      this.load(true)      api_get('/api/countries').then(data => this.countries = data);      api_get('/api/clients').then(data => {        this.clients = data        console.log(this.clients);      });      api_get('/api/items').then(data => this.items = data);      api_get('/api/invoices').then(data => this.invoices = data);      api_get('/api/invoice_statuses').then(data => this.states = data);      this.load_data();    },    async load_data() {      this.load(true)      this.invoices = await api_get('/api/invoices');      this.load(false)    },    close() {      this.dialog = false;    },    async save() {      console.log(this.newInvoice);      this.load(true);      await api_post('/api/invoices', {        items: this.newInvoice.items.map(id => `/api/items/${id}`),        client: {          id: `/api/clients/${this.newInvoice.client}`        },        status: `/api/invoice_statuses/${this.newInvoice.status}`      });      this.close()      this.newInvoice = {};      await this.load_data();      this.load(false);    },    load(state) {      this.isLoading = state;    },    sendToClient(item) {      api_patch(`/api/invoices/${item.id}`, {        status: `/api/invoice_statuses/${this.states[1].id}`      }).then((res) => {        item.status = this.states.find(s => s.id === res.status.id);      });    },    markAsPaid(item) {      api_patch(`/api/invoices/${item.id}`, {        status: `/api/invoice_statuses/${this.states[2].id}`      }).then((res) => {        item.status = this.states.find(s => s.id === res.status.id);      });    }  }}</script><style scoped></style>